#!/usr/bin/env atkins
# Atkins CI: https://github.com/titpetric/atkins

name: Vuego CI pipeline

vars:
  name: vuego

jobs:
  default:
    desc: "Format, lint and test"
    steps:
      - task: fmt
      - task: lint
      - task: test

  fmt:
    desc: "Format the code"
    steps:
      - goimports -w -local $(go list .) .
      - goimports-reviser -set-alias -format -imports-order "std,blanked,general,company,project" ./...
      - go fmt ./...
      - go mod tidy

  lint:
    desc: "Lint the code"
    parallel: true
    steps:
      - go-fsck lint ./... --exclude imports
      - golangci-lint run --fix ./...

  test:
    desc: "Run built tests"
    steps:
      - go test -count=1 -cover -coverpkg=./... -coverprofile=pkg.cov ./...
