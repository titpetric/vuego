<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VueGo Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #007d9c;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 500;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }

        main {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            padding: 1rem;
            overflow: hidden;
        }

        .config-bar {
            background: white;
            padding: 0.75rem 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .config-bar label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .config-bar input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .status-text {
            margin-left: auto;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .panel {
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            padding: 0.75rem 1rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: #495057;
        }

        .panel-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        textarea {
            width: 100%;
            height: 100%;
            border: none;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: none;
            outline: none;
        }

        #preview {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            display: none;
        }

        #error {
            padding: 1rem;
            overflow: auto;
            background: #fff5f5;
            color: #c53030;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            display: none;
        }

        button {
            background: #007d9c;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: background 0.2s;
        }

        button:hover {
            background: #006080;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .spinner {
            display: none;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007d9c;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


    </style>
</head>
<body>
    <header>
        <h1>VueGo Playground</h1>
        <div class="subtitle">Test your VueGo templates in real-time</div>
    </header>

    <div class="config-bar">
        <label>
            <input type="checkbox" id="autoRefresh" checked>
            Auto-refresh
        </label>
        <button onclick="render()">Render Now</button>
        <button onclick="loadExample('basic')">Basic</button>
        <button onclick="loadExample('filters')">Filters</button>
        <button onclick="loadExample('conditional')">Conditional</button>
        <button onclick="loadExample('dashboard')">Dashboard</button>
        <button onclick="loadExample('blog')">Blog Post</button>
        <div class="spinner" id="spinner"></div>
        <span class="status-text" id="status"></span>
    </div>

    <main>
        <div class="panel">
            <div class="panel-header">Data (JSON)</div>
            <div class="panel-content">
                <textarea id="data" placeholder="Enter JSON data here...">{
  "title": "Welcome to VueGo",
  "name": "developer",
  "items": ["First item", "Second item", "Third item"]
}</textarea>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">Template</div>
            <div class="panel-content">
                <textarea id="template" placeholder="Enter your VueGo template here...">&lt;div&gt;
  &lt;h1&gt;{{ title }}&lt;/h1&gt;
  &lt;p&gt;Hello, {{ name | upper }}!&lt;/p&gt;
  &lt;ul&gt;
    &lt;li v-for="item in items"&gt;{{ item }}&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;</textarea>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">Output</div>
            <div class="panel-content">
                <iframe id="preview"></iframe>
                <div id="error"></div>
            </div>
        </div>
    </main>

    <script>
        const examples = {
            basic: {
                template: `<div>
  <h1>{{ title }}</h1>
  <p>Hello, {{ name }}!</p>
  <ul>
    <li v-for="item in items">{{ item }}</li>
  </ul>
</div>`,
                data: `{
  "title": "Welcome to VueGo",
  "name": "developer",
  "items": ["First", "Second", "Third"]
}`
            },
            filters: {
                template: `<div>
  <h2>{{ heading | upper }}</h2>
  <p>{{ text | trim | title }}</p>
  <p>Count: {{ items | len }}</p>
  <p>Default: {{ missing | default("Not provided") }}</p>
</div>`,
                data: `{
  "heading": "filter examples",
  "text": "  hello world  ",
  "missing": null,
  "items": [1, 2, 3, 4, 5]
}`
            },
            conditional: {
                template: `<div>
  <div v-if="showWelcome">
    <h1>Welcome!</h1>
  </div>
  <div v-if="!showWelcome">
    <h1>Goodbye!</h1>
  </div>
  <div v-if="len(users)">
    <h3>Users ({{ users | len }}):</h3>
    <ul>
      <li v-for="user in users">{{ user.name }} - {{ user.email }}</li>
    </ul>
  </div>
</div>`,
                data: `{
  "showWelcome": true,
  "users": [
    {"name": "Alice", "email": "alice@example.com"},
    {"name": "Bob", "email": "bob@example.com"}
  ]
}`
            },
            dashboard: {
                template: `<div>
  <h1>My Dashboard</h1>
  <p>{{ date }}</p>

  <h2>üå§Ô∏è Weather</h2>
  <p><strong>{{ weather.location }}</strong></p>
  <p>{{ weather.temperature }}¬∞C - {{ weather.condition }}</p>
  <p><em>Feels like {{ weather.feelsLike }}¬∞C</em></p>
  <ul>
    <li>Humidity: {{ weather.humidity }}%</li>
    <li>Wind: {{ weather.wind }} km/h</li>
  </ul>

  <h2>üìÖ Calendar</h2>
  <ul>
    <li v-for="event in calendar">
      <strong>{{ event.time }}</strong> - {{ event.title }}
      <div v-if="event.location" style="padding-left: 1.5em; color: #666;">
        üìç {{ event.location }}
      </div>
    </li>
  </ul>

  <h2>‚úÖ Today's Tasks</h2>
  <ul style="list-style: none; padding-left: 0;">
    <li v-for="task in tasks">
      <input type="checkbox" v-bind:checked="task.done" v-bind:id="task.id">
      <label v-bind:for="task.id" v-bind:style="task.done ? 'text-decoration: line-through; color: #999;' : ''">
        {{ task.title }}
      </label>
      <div v-if="task.priority === 'high'" style="display: inline; color: #c53030; margin-left: 0.5em;">‚ö†Ô∏è</div>
    </li>
  </ul>
</div>`,
                data: `{
  "date": "Friday, November 14, 2025",
  "weather": {
    "location": "San Francisco, CA",
    "temperature": 18,
    "feelsLike": 16,
    "condition": "Partly Cloudy",
    "humidity": 65,
    "wind": 12
  },
  "calendar": [
    {"time": "09:00", "title": "Team standup", "location": "Conference Room A"},
    {"time": "11:00", "title": "Code review session", "location": null},
    {"time": "14:00", "title": "Product planning", "location": "Zoom"},
    {"time": "16:30", "title": "1:1 with manager", "location": "Coffee shop"}
  ],
  "tasks": [
    {"id": "task1", "title": "Review pull requests", "done": true, "priority": "medium"},
    {"id": "task2", "title": "Fix authentication bug", "done": false, "priority": "high"},
    {"id": "task3", "title": "Update documentation", "done": false, "priority": "low"},
    {"id": "task4", "title": "Respond to support tickets", "done": true, "priority": "medium"},
    {"id": "task5", "title": "Prepare demo for client", "done": false, "priority": "high"}
  ]
}`
            },
            blog: {
                template: `<article>
  <h1>{{ title }}</h1>
  <p><em>By {{ author }} on {{ date }}</em></p>
  
  <p>{{ intro }}</p>

  <h2>Key Features</h2>
  <ul>
    <li v-for="feature in features">
      <strong>{{ feature.name }}</strong>: {{ feature.description }}
    </li>
  </ul>

  <h2>Getting Started</h2>
  <p>Follow these steps to begin:</p>
  <ol>
    <li v-for="step in steps">{{ step }}</li>
  </ol>

  <blockquote>
    {{ quote.text }}
    <br><strong>‚Äî {{ quote.author }}</strong>
  </blockquote>

  <h2>Code Example</h2>
  <p>Here's a simple example:</p>
  <pre><code>{{ codeExample }}</code></pre>

  <hr>
  
  <h3>Related Articles</h3>
  <ul>
    <li v-for="article in related">
      <a href="#">{{ article }}</a>
    </li>
  </ul>

  <p><small>Tags: <span v-for="tag in tags">{{ tag }} </span></small></p>
</article>`,
                data: `{
  "title": "Building Modern Web Applications with VueGo",
  "author": "Jane Developer",
  "date": "November 14, 2025",
  "intro": "VueGo combines the simplicity of Vue.js-style templates with the power of Go's template engine. This article explores how to leverage both for building dynamic, server-rendered applications.",
  "features": [
    {
      "name": "Server-Side Rendering",
      "description": "Render templates on the server for better SEO and initial load performance"
    },
    {
      "name": "Familiar Syntax",
      "description": "Use Vue.js-like directives (v-if, v-for, v-bind) that feel natural"
    },
    {
      "name": "Type Safety",
      "description": "Leverage Go's type system for robust template rendering"
    }
  ],
  "steps": [
    "Install VueGo package with go get",
    "Create your first template with .vuego extension",
    "Set up data as a map[string]any",
    "Render using vue.Render()",
    "Enjoy your dynamic HTML!"
  ],
  "quote": {
    "text": "Simplicity is the ultimate sophistication.",
    "author": "Leonardo da Vinci"
  },
  "codeExample": "vue := vuego.NewVue(templateFS)\\nvar buf bytes.Buffer\\nerr := vue.Render(&buf, \\"page.vuego\\", data)",
  "related": [
    "Understanding Template Directives",
    "Advanced Filtering Techniques",
    "Building Reusable Components"
  ],
  "tags": ["golang", "templates", "vue", "web-development", "ssr"]
}`
            }
        };

        let debounceTimer = null;
        let isRendering = false;

        function loadExample(name) {
            const example = examples[name];
            if (example) {
                document.getElementById('template').value = example.template;
                document.getElementById('data').value = example.data;
                render();
            }
        }

        async function render() {
            if (isRendering) return;
            
            const template = document.getElementById('template').value;
            const dataStr = document.getElementById('data').value;
            const spinner = document.getElementById('spinner');
            const status = document.getElementById('status');
            const preview = document.getElementById('preview');
            const error = document.getElementById('error');

            // Parse data JSON first to validate
            let data;
            try {
                data = JSON.parse(dataStr);
            } catch (e) {
                error.textContent = `Invalid JSON data: ${e.message}`;
                error.style.display = 'block';
                preview.style.display = 'none';
                return;
            }

            isRendering = true;
            spinner.style.display = 'block';
            status.textContent = 'Rendering...';
            error.style.display = 'none';
            preview.style.display = 'none';

            try {
                const response = await fetch('/api/render', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        template: template,
                        data: dataStr
                    })
                });

                const result = await response.json();

                if (result.error) {
                    error.textContent = result.error;
                    error.style.display = 'block';
                    preview.style.display = 'none';
                    status.textContent = 'Error';
                } else {
                    // Create isolated iframe document with base styling
                    const iframeDoc = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 2rem;
            line-height: 1.6;
            color: #333;
        }
        h1, h2, h3, h4, h5, h6 {
            margin: 1.5em 0 0.5em 0;
            line-height: 1.3;
            font-weight: 600;
            color: #1a1a1a;
        }
        h1:first-child, h2:first-child, h3:first-child {
            margin-top: 0;
        }
        h1 { font-size: 2em; }
        h2 { font-size: 1.5em; }
        h3 { font-size: 1.25em; }
        h4 { font-size: 1.1em; }
        h5 { font-size: 1em; }
        h6 { font-size: 0.9em; }
        p { margin: 0 0 1em 0; }
        ul, ol {
            margin: 0 0 1em 0;
            padding-left: 2em;
        }
        li { margin: 0.25em 0; }
        ul ul, ol ol, ul ol, ol ul { margin: 0.25em 0; }
        strong, b { font-weight: 600; }
        em, i { font-style: italic; }
        u { text-decoration: underline; }
        a {
            color: #007d9c;
            text-decoration: none;
        }
        a:hover { text-decoration: underline; }
        code {
            background: #f5f5f5;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        pre {
            background: #f5f5f5;
            padding: 1em;
            border-radius: 4px;
            overflow-x: auto;
            margin: 0 0 1em 0;
        }
        pre code {
            background: none;
            padding: 0;
        }
        blockquote {
            border-left: 4px solid #e9ecef;
            margin: 0 0 1em 0;
            padding: 0.5em 0 0.5em 1em;
            color: #666;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 0 0 1em 0;
        }
        th, td {
            border: 1px solid #e9ecef;
            padding: 0.5em;
            text-align: left;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        hr {
            border: none;
            border-top: 1px solid #e9ecef;
            margin: 2em 0;
        }
        input[type="checkbox"] {
            margin-right: 0.5em;
        }
    </style>
</head>
<body>
${result.html}
</body>
</html>`;
                    preview.srcdoc = iframeDoc;
                    preview.style.display = 'block';
                    error.style.display = 'none';
                    status.textContent = 'Success';
                    setTimeout(() => status.textContent = '', 2000);
                }
            } catch (e) {
                error.textContent = `Network error: ${e.message}`;
                error.style.display = 'block';
                preview.style.display = 'none';
                status.textContent = 'Error';
            } finally {
                isRendering = false;
                spinner.style.display = 'none';
            }
        }

        function scheduleRender() {
            if (!document.getElementById('autoRefresh').checked) return;
            
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                render();
            }, 500);
        }

        // Setup auto-refresh listeners
        document.getElementById('template').addEventListener('input', scheduleRender);
        document.getElementById('data').addEventListener('input', scheduleRender);

        // Keyboard shortcut: Ctrl+Enter or Cmd+Enter to render
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                render();
            }
        });

        // Auto-render on load
        window.addEventListener('load', () => {
            setTimeout(render, 100);
        });
    </script>
</body>
</html>
